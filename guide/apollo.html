<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>apollo | TopUnicorn</title>
    <meta name="description" content="为企业云而生">
    <link rel="icon" href="/sites/favicon.ico">
    
    <link rel="preload" href="/sites/assets/css/0.styles.b5acc818.css" as="style"><link rel="preload" href="/sites/assets/js/app.481a8143.js" as="script"><link rel="preload" href="/sites/assets/js/2.1328de9b.js" as="script"><link rel="preload" href="/sites/assets/js/46.e598661a.js" as="script"><link rel="prefetch" href="/sites/assets/js/10.8e067f10.js"><link rel="prefetch" href="/sites/assets/js/11.a60a68bf.js"><link rel="prefetch" href="/sites/assets/js/12.23685d4f.js"><link rel="prefetch" href="/sites/assets/js/13.92dbaef6.js"><link rel="prefetch" href="/sites/assets/js/14.1d800576.js"><link rel="prefetch" href="/sites/assets/js/15.8d76eaf1.js"><link rel="prefetch" href="/sites/assets/js/16.901c92ee.js"><link rel="prefetch" href="/sites/assets/js/17.95c1ce64.js"><link rel="prefetch" href="/sites/assets/js/18.ad31dfb0.js"><link rel="prefetch" href="/sites/assets/js/19.3913d806.js"><link rel="prefetch" href="/sites/assets/js/20.b2dc85d6.js"><link rel="prefetch" href="/sites/assets/js/21.14e64189.js"><link rel="prefetch" href="/sites/assets/js/22.a1438998.js"><link rel="prefetch" href="/sites/assets/js/23.d239bce7.js"><link rel="prefetch" href="/sites/assets/js/24.fde94c27.js"><link rel="prefetch" href="/sites/assets/js/25.6ed484f9.js"><link rel="prefetch" href="/sites/assets/js/26.c10f1892.js"><link rel="prefetch" href="/sites/assets/js/27.9c1d644c.js"><link rel="prefetch" href="/sites/assets/js/28.f9a7efaf.js"><link rel="prefetch" href="/sites/assets/js/29.cb3244b1.js"><link rel="prefetch" href="/sites/assets/js/3.28419bae.js"><link rel="prefetch" href="/sites/assets/js/30.01e81c54.js"><link rel="prefetch" href="/sites/assets/js/31.497f5224.js"><link rel="prefetch" href="/sites/assets/js/32.4f5a21f1.js"><link rel="prefetch" href="/sites/assets/js/33.4214f7bd.js"><link rel="prefetch" href="/sites/assets/js/34.6e75de5f.js"><link rel="prefetch" href="/sites/assets/js/35.d833ef2f.js"><link rel="prefetch" href="/sites/assets/js/36.f4857f4f.js"><link rel="prefetch" href="/sites/assets/js/37.b43ef3f0.js"><link rel="prefetch" href="/sites/assets/js/38.20f4141a.js"><link rel="prefetch" href="/sites/assets/js/39.d3ddfbdb.js"><link rel="prefetch" href="/sites/assets/js/4.5b3e85ea.js"><link rel="prefetch" href="/sites/assets/js/40.a5e7dade.js"><link rel="prefetch" href="/sites/assets/js/41.691b1c1e.js"><link rel="prefetch" href="/sites/assets/js/42.2272ee55.js"><link rel="prefetch" href="/sites/assets/js/43.44179df7.js"><link rel="prefetch" href="/sites/assets/js/44.b039940d.js"><link rel="prefetch" href="/sites/assets/js/45.591aa47f.js"><link rel="prefetch" href="/sites/assets/js/47.f18ae697.js"><link rel="prefetch" href="/sites/assets/js/48.846f1978.js"><link rel="prefetch" href="/sites/assets/js/49.f8fdbd22.js"><link rel="prefetch" href="/sites/assets/js/5.ce2090cc.js"><link rel="prefetch" href="/sites/assets/js/50.b83dc72c.js"><link rel="prefetch" href="/sites/assets/js/51.a283132e.js"><link rel="prefetch" href="/sites/assets/js/52.043b5611.js"><link rel="prefetch" href="/sites/assets/js/53.bf363579.js"><link rel="prefetch" href="/sites/assets/js/54.ab69e0e5.js"><link rel="prefetch" href="/sites/assets/js/55.1331854c.js"><link rel="prefetch" href="/sites/assets/js/56.0315c64a.js"><link rel="prefetch" href="/sites/assets/js/57.0057d56c.js"><link rel="prefetch" href="/sites/assets/js/58.5e6a3df1.js"><link rel="prefetch" href="/sites/assets/js/59.62f33205.js"><link rel="prefetch" href="/sites/assets/js/6.939b8685.js"><link rel="prefetch" href="/sites/assets/js/60.1d9c11c9.js"><link rel="prefetch" href="/sites/assets/js/61.e1e8ed74.js"><link rel="prefetch" href="/sites/assets/js/62.ef8b5761.js"><link rel="prefetch" href="/sites/assets/js/63.989fb0c0.js"><link rel="prefetch" href="/sites/assets/js/64.70f3dcda.js"><link rel="prefetch" href="/sites/assets/js/65.074ee239.js"><link rel="prefetch" href="/sites/assets/js/66.e9854488.js"><link rel="prefetch" href="/sites/assets/js/67.cc88db87.js"><link rel="prefetch" href="/sites/assets/js/68.0fcefa17.js"><link rel="prefetch" href="/sites/assets/js/69.360c9c32.js"><link rel="prefetch" href="/sites/assets/js/7.866de064.js"><link rel="prefetch" href="/sites/assets/js/70.51490900.js"><link rel="prefetch" href="/sites/assets/js/71.a04b0753.js"><link rel="prefetch" href="/sites/assets/js/72.c75e1d55.js"><link rel="prefetch" href="/sites/assets/js/8.aeae1da0.js"><link rel="prefetch" href="/sites/assets/js/9.c11fe44f.js">
    <link rel="stylesheet" href="/sites/assets/css/0.styles.b5acc818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sites/" class="home-link router-link-active"><!----> <span class="site-name">TopUnicorn</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/sites/guide/" class="nav-link router-link-active">文档指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">赋能</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">统一门户平台</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">注册中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">配置中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">鉴权中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">分布式消息队列中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">分布式调度中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">分布式计算中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">数据存储中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">监控中心</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/sites/guide/" class="nav-link router-link-active">文档指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">赋能</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">统一门户平台</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">注册中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">配置中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">鉴权中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">分布式消息队列中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">分布式调度中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">分布式计算中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">数据存储中心</a></li><li class="dropdown-item"><!----> <a href="/sites/guide/.html" class="nav-link">监控中心</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>平台概述</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sites/guide/" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>统一门户平台</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sites/guide/apollo.html" class="active sidebar-link">apollo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sites/guide/apollo.html#apollo配置中心使用说明" class="sidebar-link"></a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="apollo"><a href="#apollo" aria-hidden="true" class="header-anchor">#</a> apollo</h1> <h2 id="apollo配置中心使用说明"><a href="#apollo配置中心使用说明" aria-hidden="true" class="header-anchor">#</a> <center>Apollo配置中心使用说明</center></h2> <p>​</p> <p>​	目前框架配置中心由spring cloud config替换为Apollo配置中心。开发环境配置已经在公司部署完毕并使用。</p> <p>访问地址为<a href="http://192.168.10.132:8070/" target="_blank" rel="noopener noreferrer">http://192.168.10.132:8070<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。服务配置为中心统一配置，多环境部署。开发默认环境为“DEV”，且提供基础环境配置，默认各个领域都参照配置。</p> <p>期望达到理想要求是各个领域只需要启动各自领域的基础工程，其他依赖工程和服务都在对应的环境部署。尽量保证与今后的测试，生产环境一致。</p> <p><strong>如有特殊要求需要修改本地配置，比如临时调整代码做测试等。可以通过如下方法设置。</strong></p> <blockquote><p>配置中心默认在本机缓存配置文件，以配置中心服务不可用时保证系统可以启用。缓存路径为</p> <p>/opt/data/$appId/config-cache/XXX.properties（Mac/Linux）</p> <p>C:\opt\data\$appId\config-cache\XXX.properties（Windows）</p></blockquote> <p>如图：</p> <p><img src="C:%5CUsers%5Ctzm%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566200012436.png" alt="1566200012436"></p> <p>Apollo客户端还支持本地开发模式，这个主要用于当开发环境无法连接Apollo服务器的时候，或者需要临时增加特殊配置的时候。</p> <p>在本地开发模式下，Apollo只会从本地文件读取配置信息，不会从Apollo服务器读取配置。</p> <p>可以通过下面的步骤开启Apollo本地开发模式。</p> <h3 id="_1-本地开发修改环境"><a href="#_1-本地开发修改环境" aria-hidden="true" class="header-anchor">#</a> 1.本地开发修改环境</h3> <blockquote><p>修改/opt/settings/server.properties（Mac/Linux）或C:\opt\settings\server.properties（Windows）文件，设置env为Local：</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>env=Local
</code></pre></div><p>如图:</p> <p><img src="C:%5CUsers%5Ctzm%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566200214754.png" alt="1566200214754"></p> <p><img src="C:%5CUsers%5Ctzm%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566200231980.png" alt="1566200231980"></p> <p>此时会读取本地缓存的配置文件，可以自行添加修改后启动项目。</p> <h3 id="_2-阿里云配置中心本地开发使用"><a href="#_2-阿里云配置中心本地开发使用" aria-hidden="true" class="header-anchor">#</a> 2.阿里云配置中心本地开发使用</h3> <p>针对某些项目本机的开发环境需要使用阿里云部署的配置中心，如果直接配置阿里云的公网地址是无法拉取到配置的。因为Apollo的<code>apollo-configservice</code>和<code>apollo-adminservice</code>是基于内网可信网络设计的，所以出于安全考虑，不会将<code>apollo-configservice</code>和<code>apollo-adminservice</code>直接暴露在公网。</p> <blockquote><p>解决办法：通过启动参数-Dapollo.configService=http://config-service的公网IP:端口来跳过meta service的服务发现</p></blockquote> <p><img src="C:%5CUsers%5Ctzm%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1568286099488.png" alt="1568286099488"></p> <h3 id="_3-前端配置接入配置中心"><a href="#_3-前端配置接入配置中心" aria-hidden="true" class="header-anchor">#</a> 3.前端配置接入配置中心</h3> <p>目前前端工程有配置项目跟代码工程剥离的需求，所以Apollo配置中心提供基于Restfull的配置拉取API。具体使用方法如下：</p> <h4 id="_3-1通过带缓存的http接口从apollo读取配置"><a href="#_3-1通过带缓存的http接口从apollo读取配置" aria-hidden="true" class="header-anchor">#</a> 3.1通过带缓存的Http接口从Apollo读取配置</h4> <p>该接口会从缓存中获取配置，适合频率较高的配置拉取请求，如简单的每30秒轮询一次配置。</p> <p>由于缓存最多会有一秒的延时，所以如果需要配合配置推送通知实现实时更新配置的话，请使用<a href="">3.2 通过不带缓存的Http接口从Apollo读取配置</a></p> <h5 id="_3-1-1-http接口说明"><a href="#_3-1-1-http接口说明" aria-hidden="true" class="header-anchor">#</a> 3.1.1 Http接口说明</h5> <p><strong>URL</strong>: {config_server_url}/configfiles/json/{appId}/{clusterName}/{namespaceName}?ip={clientIp}</p> <p><strong>Method</strong>: GET</p> <table><thead><tr><th>参数名</th> <th>是否必须</th> <th>参数值</th> <th>备注</th></tr></thead> <tbody><tr><td>config_server_url</td> <td>是</td> <td>Apollo配置服务的地址</td> <td></td></tr> <tr><td>appId</td> <td>是</td> <td>应用的appId</td> <td></td></tr> <tr><td>clusterName</td> <td>是</td> <td>集群名</td> <td>一般情况下传入 default 即可。 如果希望配置按集群划分，可以参考<a href="">集群独立配置说明</a>做相关配置，然后在这里填入对应的集群名。</td></tr> <tr><td>namespaceName</td> <td>是</td> <td>Namespace的名字</td> <td>如果没有新建过Namespace的话，传入application即可。 如果创建了Namespace，并且需要使用该Namespace的配置，则传入对应的Namespace名字。<strong>需要注意的是对于properties类型的namespace，只需要传入namespace的名字即可，如application。对于其它类型的namespace，需要传入namespace的名字加上后缀名，如datasources.json</strong></td></tr> <tr><td>ip</td> <td>否</td> <td>应用部署的机器ip</td> <td>这个参数是可选的，用来实现灰度发布。 如果不想传这个参数，请注意URL中从?号开始的query parameters整个都不要出现。</td></tr></tbody></table> <p>使用公司环境测试 http://192.168.10.132:8080/configfiles/json/demo/default/application</p> <h5 id="_3-1-2-http接口返回格式"><a href="#_3-1-2-http接口返回格式" aria-hidden="true" class="header-anchor">#</a> 3.1.2 Http接口返回格式</h5> <p>该Http接口返回的是JSON格式、UTF-8编码，包含了对应namespace中所有的配置项。</p> <p>返回内容Sample如下：</p> <p><img src="C:%5CUsers%5Ctzm%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1570792899353.png" alt="1570792899353"></p> <h4 id="_3-2-通过不带缓存的http接口从apollo读取配置"><a href="#_3-2-通过不带缓存的http接口从apollo读取配置" aria-hidden="true" class="header-anchor">#</a> 3.2 通过不带缓存的Http接口从Apollo读取配置</h4> <p>该接口会直接从数据库中获取配置，可以配合配置推送通知实现实时更新配置。</p> <h5 id="_3-2-1-http接口说明"><a href="#_3-2-1-http接口说明" aria-hidden="true" class="header-anchor">#</a> 3.2.1 Http接口说明</h5> <p><strong>URL</strong>: {config_server_url}/configs/{appId}/{clusterName}/{namespaceName}?releaseKey={releaseKey}&amp;ip={clientIp}</p> <p><strong>Method</strong>: GET</p> <p><strong>参数说明</strong></p> <table><thead><tr><th>参数名</th> <th>是否必须</th> <th>参数值</th> <th>备注</th></tr></thead> <tbody><tr><td>config_server_url</td> <td>是</td> <td>Apollo配置服务的地址</td> <td></td></tr> <tr><td>appId</td> <td>是</td> <td>应用的appId</td> <td></td></tr> <tr><td>clusterName</td> <td>是</td> <td>集群名</td> <td>一般情况下传入 default 即可。 如果希望配置按集群划分，可以参考<a href="">集群独立配置说明</a>做相关配置，然后在这里填入对应的集群名。</td></tr> <tr><td>namespaceName</td> <td>是</td> <td>Namespace的名字</td> <td>如果没有新建过Namespace的话，传入application即可。 如果创建了Namespace，并且需要使用该Namespace的配置，则传入对应的Namespace名字。<strong>需要注意的是对于properties类型的namespace，只需要传入namespace的名字即可，如application。对于其它类型的namespace，需要传入namespace的名字加上后缀名，如datasources.json</strong></td></tr> <tr><td>releaseKey</td> <td>否</td> <td>上一次的releaseKey</td> <td>将上一次返回对象中的releaseKey传入即可，用来给服务端比较版本，如果版本比下来没有变化，则服务端直接返回304以节省流量和运算</td></tr> <tr><td>ip</td> <td>否</td> <td>应用部署的机器ip</td> <td>这个参数是可选的，用来实现灰度发布。</td></tr></tbody></table> <p>使用公司环境测试 http://192.168.10.132:8080/configs/demo/default/application</p> <h5 id="_3-2-2-http接口返回格式"><a href="#_3-2-2-http接口返回格式" aria-hidden="true" class="header-anchor">#</a> 3.2.2 Http接口返回格式</h5> <p>该Http接口返回的是JSON格式、UTF-8编码。</p> <p>如果配置没有变化（传入的releaseKey和服务端的相等），则返回HttpStatus 304，response body为空。</p> <p>如果配置有变化，则会返回HttpStatus 200，response body为对应namespace的meta信息以及其中所有的配置项。</p> <p>返回内容Sample如下：</p> <p><img src="C:%5CUsers%5Ctzm%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1570793098314.png" alt="1570793098314"></p> <blockquote><p>server.properties的配置文件还可以设置多环境，集群，appid切换等。目前开发暂时用不到这些配置。后续根据情况再跟大家补充相关配置的使用讲解。</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2020-4-2 16:28:59</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/sites/guide/" class="prev router-link-active">
          简介
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sites/assets/js/2.1328de9b.js" defer></script><script src="/sites/assets/js/46.e598661a.js" defer></script><script src="/sites/assets/js/app.481a8143.js" defer></script>
  </body>
</html>
